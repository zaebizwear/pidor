<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Симулятор Бабки Нинки</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lobster&display=swap" rel="stylesheet">
    <style>
        /* Общие стили для всего документа */
        body, html {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            margin: 0;
            overflow: hidden; /* Скрыть прокрутку для body/html */
            width: 100%;
            height: 100%;
        }

        /* Стиль для шрифта Lobster (для заголовков) */
        .font-lobster {
            font-family: 'Lobster', cursive;
        }

        /* Оверлей для портретной ориентации */
        #orientation-overlay {
            display: none; /* Скрыто по умолчанию */
            position: fixed;
            inset: 0;
            background-color: #111;
            color: white;
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
        }

        /* Контейнер приложения - центрирует игровую область */
        #app-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background-color: #f3e9dc; /* Фоновый цвет за пределами игры */
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23d4c4b0" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); /* Фоновый узор */
            position: relative; /* Для правильного позиционирования дочерних элементов */
        }

        /* Основной игровой контейнер - поддерживает соотношение 16:9 */
        #game-container {
            border: 10px solid transparent;
            border-image: url('data:image/svg+xml;charset=UTF-8,%3csvg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"%3e%3cpath fill-rule="evenodd" clip-rule="evenodd" d="M16 0L20.6959 5.8622L27.5251 4.21885L29.6574 11.2189L32 16L29.6574 20.7811L27.5251 27.7812L20.6959 26.1378L16 32L11.3041 26.1378L4.47487 27.7812L2.34259 20.7811L0 16L2.34259 11.2189L4.47487 4.21885L11.3041 5.8622L16 0Z" fill="%238B4513"/%3e%3cpath fill-rule="evenodd" clip-rule="evenodd" d="M16 4L19.3496 8.35634L24.3375 7.1498L25.9618 12.311L28 16L25.9618 19.689L24.3375 24.8502L19.3496 23.6437L16 28L12.6504 23.6437L7.66248 24.8502L6.03819 19.689L4 16L6.03819 12.311L7.66248 7.1498L12.6504 8.35634L16 4Z" fill="%23D2691E"/%3e%3c/svg%3e') 10 round;
            background-color: #fff8f0;

            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            
            /* Расчет размеров для 16:9, занимая максимум пространства без обрезки */
            width: 100vw;
            height: calc(100vw * 9 / 16); /* Высота на основе ширины */
            max-height: 100vh;
            max-width: calc(100vh * 16 / 9); /* Ширина на основе высоты */

            /* Минимальные размеры для очень маленьких экранов */
            min-width: 320px;
            min-height: calc(320px * 9 / 16);

            display: flex;
            flex-direction: column;
            box-sizing: border-box; /* Учитывает padding и border в общих размерах */
            padding: 1vmin; /* Адаптивный внутренний отступ для всего контейнера */
        }

        /* Игровой экран */
        #game-screen {
            display: flex;
            width: 100%;
            height: 100%;
            justify-content: center;
            align-items: center;
        }

        /* Разметка Grid для двух основных колонок (статистика и действия) */
        .game-grid-layout { /* Новое имя класса для более точного контроля */
            display: grid;
            grid-template-columns: 0.3fr 0.7fr; /* Левая колонка 30%, правая 70% */
            gap: 1vmin; /* Адаптивный зазор между колонками */
            height: calc(100% - 7vmin - 1vmin); /* 100% минус заголовок и отступы */
            /* 7vmin от responsive-text-5xl для h1, 1vmin для mb-2, 1vmin для pb-2 (приблизительно) */
            overflow: hidden; /* Скрыть прокрутку для всей сетки */
            flex-grow: 1; /* Позволить сетке занимать оставшееся пространство */
        }

        /* Левая колонка (статистика персонажа) */
        .stats-column { /* Новое имя класса */
            display: flex;
            flex-direction: column;
            background-color: #f3e9dc;
            padding: 1vmin; /* Адаптивный внутренний отступ */
            border-radius: 0.8vmin;
            border: 0.2vmin solid #d4c4b0;
            overflow-y: auto; /* Прокрутка, если содержимое не помещается */
            flex-shrink: 0; /* Не сжимать эту колонку */
            width: 100%; /* Занимает всю ширину своей ячейки грида */
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch; /* Для плавной прокрутки на iOS */
        }

        /* Правая колонка (сообщения и действия) */
        .actions-column { /* Новое имя класса */
            display: flex;
            flex-direction: column;
            flex-grow: 1; /* Позволить этой колонке занимать оставшееся пространство */
            overflow: hidden; /* Скрыть общую прокрутку, внутренние элементы будут прокручиваться */
            box-sizing: border-box;
        }

        /* Поле для сообщений */
        #message-box {
            height: 25%; /* Высота 25% от доступной высоты родителя */
            min-height: 80px; /* Минимальная высота для чтения */
            background-color: #faf3e0;
            padding: 1vmin; /* Адаптивный внутренний отступ */
            border-radius: 0.8vmin;
            border: 0.2vmin solid #a0a0a0;
            overflow-y: auto; /* Автоматическая прокрутка для сообщений */
            flex-shrink: 0; /* Не сжимать */
            margin-bottom: 0.8vmin; /* Адаптивный нижний отступ */
            box-sizing: border-box;
            text-align: left; /* Выравнивание текста по левому краю */
            -webkit-overflow-scrolling: touch;
        }

        /* Контейнер кнопок действий */
        .actions-buttons-grid { /* Новое имя класса */
            display: grid; /* Используем grid для выравнивания */
            grid-template-columns: repeat(auto-fit, minmax(calc(25% - 1vmin), 1fr)); /* 4 кнопки в ряд, адаптивно */
            grid-auto-rows: 1fr; /* Делает все строки одинаковой высоты */
            gap: 0.8vmin; /* Адаптивный зазор между кнопками */
            padding-top: 0.5vmin; /* Адаптивный отступ сверху */
            flex-grow: 1; /* Занимает оставшееся пространство в колонке */
            overflow-y: auto; /* Прокрутка, если кнопок слишком много */
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch;
        }

        /* Отдельная кнопка действия */
        .action-button {
            /*flex-basis: calc(50% - 0.25vmin); /* 2 кнопки в ряду на узких экранах */
            /*max-width: calc(50% - 0.25vmin); */
            display: flex; /* Для центрирования текста по вертикали */
            align-items: center; /* Центрирование текста по вертикали */
            justify-content: center; /* Центрирование текста по горизонтали */
            box-sizing: border-box;
            font-size: 2.2vmin; /* Адаптивный шрифт */
            padding: 1.2vmin 0.8vmin; /* Адаптивный padding */
            line-height: 1.2;
            text-align: center;
            border-radius: 0.8vmin;
            border-bottom-width: 0.4vmin; /* Адаптивная ширина границы */
            transition: all 0.1s ease-in-out; /* Плавный переход */
            height: 100%; /* Занимает всю высоту ячейки грида */
            min-height: 50px; /* Минимальная высота, чтобы кнопки не были слишком маленькими */
        }

        /* Медиа-запрос для ПК и более широких экранов (4 кнопки в ряду) */
        @media (min-width: 768px) { /* md breakpoint по TailwindCSS */
            .actions-buttons-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 кнопки в ряд */
            }
        }
        @media (max-width: 767px) { /* Меньше md breakpoint */
            .actions-buttons-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 кнопки в ряд */
            }
        }


        /* Анимация тряски */
        .shake-animation { animation: shake 0.5s; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        /* Состояния кнопок */
        .action-button:active { transform: translateY(0.2vmin); border-bottom-width: 0.2vmin; }
        .action-button:disabled { background-color: #9ca3af; border-color: #4b5563; cursor: not-allowed; }

        /* Стиль для скримера */
        #screamer-modal { animation-iteration-count: 5; }
        #screamer-image { width: 100%; height: 100%; object-fit: cover; }

        /* Оверлей портретной ориентации - отображается только в портрете */
        @media (orientation: portrait) {
            #orientation-overlay { display: flex; }
            #app-container { display: none; }
        }

        /* Адаптивные размеры шрифтов на основе vmin */
        .responsive-text-base { font-size: 2.2vmin; }
        .responsive-text-lg { font-size: 2.6vmin; }
        .responsive-text-xl { font-size: 3vmin; }
        .responsive-text-2xl { font-size: 3.4vmin; }
        .responsive-text-3xl { font-size: 4vmin; }
        .responsive-text-5xl { font-size: 6vmin; }

        /* Специальные стили для элементов в статистике */
        .stats-column .space-y-1 > div {
            margin-bottom: 0.5vmin; /* Более компактные элементы статистики */
        }
        .stats-column .space-y-1 > * + * {
            margin-top: 0.5vmin !important;
        }

        /* Изображение Бабы Нины */
        #nina-sprite {
            width: 13vmin;
            height: 13vmin;
            min-width: 80px; /* Минимальный размер, чтобы не исчезло */
            min-height: 80px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0.2vmin 0.2vmin 0.5vmin rgba(0,0,0,0.3);
            border: 0.4vmin solid white;
        }

        /* Фото жениха */
        #suitor-photo-container img {
            width: 10vmin;
            height: 10vmin;
            min-width: 60px;
            min-height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 0.4vmin solid #f06292; /* Розовая рамка для жениха */
        }

        /* Главное меню */
        #main-menu {
            display: flex; /* Важно: должен быть flex для центрирования содержимого */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
        }
        #main-menu h1 {
            font-size: 8vmin;
            margin-bottom: 2vmin;
            text-shadow: 0.2vmin 0.2vmin 0.4vmin #000, 0 0 1vmin #ff00de;
        }
        #main-menu .flex {
            gap: 1vmin; /* Адаптивный зазор между кнопками меню */
        }
        #main-menu button {
            font-size: 4vmin;
            padding: 1.5vmin 3vmin;
            border-radius: 0.8vmin;
            border-bottom-width: 0.4vmin;
            transition: all 0.2s transform;
        }
        #main-menu button:hover {
            transform: scale(1.05);
        }
        #main-menu button:active {
            transform: translateY(0.2vmin);
            border-bottom-width: 0.2vmin;
        }

        /* Стили для модальных окон (game over, win, suitor) */
        #game-over-modal > div, #game-win-modal > div, #suitor-modal > div {
            padding: 3vmin;
            border-radius: 1vmin;
            box-shadow: 0.5vmin 0.5vmin 2vmin rgba(0,0,0,0.5);
            max-width: 80vw; /* Ограничить ширину модалки */
            box-sizing: border-box;
        }
        #game-over-modal h2, #game-win-modal h2, #suitor-modal h2 {
            font-size: 5vmin;
            margin-bottom: 1.5vmin;
        }
        #game-over-modal p, #game-win-modal p, #suitor-modal p {
            font-size: 3vmin;
            margin-bottom: 2vmin;
        }
        #game-over-modal button, #game-win-modal button, #suitor-modal button {
            font-size: 3.5vmin;
            padding: 1.5vmin 3vmin;
            border-radius: 0.8vmin;
        }

        /* Заголовок времени */
        #time-display {
            font-size: 3.4vmin;
            margin-top: 0.5vmin;
        }
    </style>
</head>
<body class="game-ui-background">

    <div id="orientation-overlay">
        <h2 class="text-4xl font-lobster mb-4">Поверни экран!</h2>
        <p class="text-2xl">Для игры в Симулятор Бабки Нинки нужна горизонтальная ориентация.</p>
            <svg class="w-24 h-24 mt-8 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-2.695v-2.695A8.25 8.25 0 008.25 6.75l-3.181 3.182" />
        </svg>
    </div>

    <div id="app-container">
        <div id="main-menu" class="hidden fixed inset-0 bg-cover bg-center z-40" style="background-image: url(https://avatars.mds.yandex.net/i?id=890ed37c2fe388ffbc0b78d0c3137796_l-4407893-270-images-thumbs&n=13)">
            <div class="w-full h-full bg-black bg-opacity-50 flex flex-col items-center justify-center p-8 text-center">
                <h1 class="font-lobster text-white">Симулятор Бабки Нинки</h1>
                <div class="mt-8 flex flex-col sm:flex-row gap-4">
                    <button onclick="startGame('normal', false)" class="bg-red-700 hover:bg-red-800 text-white font-bold">
                        Новая игра
                    </button>
                    <button onclick="startGame('normal', true)" id="continue-button" class="bg-blue-700 hover:bg-blue-800 text-white font-bold">
                        Продолжить
                    </button>
                    <button onclick="startGame('hard', false)" id="hard-mode-button" class="bg-purple-700 hover:bg-purple-800 text-white font-bold">
                        Сложный режим
                    </button>
                </div>
            </div>
        </div>

        <div id="game-screen" class="hidden game-wrapper">
            <div id="game-container" class="w-full bg-[#fff8f0] p-4 shadow-2xl flex flex-col">
                    <div class="text-center mb-2 border-b-4 border-dashed border-[#8B4513] pb-2">
                        <h1 class="responsive-text-5xl font-lobster text-red-700" style="text-shadow: 1px 1px 2px #000;">Симулятор Бабки Нинки</h1>
                        <p id="time-display" class="responsive-text-2xl text-gray-800 mt-1 font-semibold">День 1, 08:00</p>
                    </div>

                    <div class="game-grid-layout">
                        <div class="stats-column">
                            <div class="flex items-center space-x-2 mb-2">
                                <div>
                                    <h2 class="responsive-text-3xl font-bold text-gray-700 font-lobster">Баба Нина</h2>
                                    <img id="nina-sprite" src="https://100biografiy.ru/wp-content/uploads/2024/07/channels4_profile-2.jpg" 
                                        onerror="this.onerror=null;this.src='https://placehold.co/200x200/d1c4e9/5a4a6b?text=Баба+Нина';"
                                        alt="Изображение Бабы Нины">
                                </div>
                                    <div id="suitor-photo-container" class="hidden"></div>
                            </div>
                            
                            <div class="w-full space-y-1 responsive-text-xl mb-2">
                                <div><span>❤️</span> <strong>Энергия:</strong> <span id="energy-val">100</span></div>
                                <div><span>😂</span> <strong>Настроение:</strong> <span id="mood-val">70</span></div>
                                <div><span>🍲</span> <strong>Сытость:</strong> <span id="hunger-val">80</span></div>
                                    <div><span>💩</span> <strong>Посрать:</strong> <span id="poop-val">0</span></div>
                                <div><span>💰</span> <strong>Лавэ:</strong> <span id="money-val">5000</span> руб.</div>
                            </div>
                            
                            <div class="w-full mt-2 pt-2 border-t-2 border-[#d4c4b0]">
                                <h3 class="responsive-text-2xl font-bold text-center text-gray-700 mb-1">Продукты 🛒</h3>
                                <div id="products-count" class="text-center responsive-text-xl font-semibold bg-white p-1 rounded border border-gray-300">
                                    0 шт.
                                </div>
                            </div>
                            <div id="child-info" class="w-full mt-1 text-center"></div>
                        </div>

                        <div class="actions-column">
                            <div id="message-box" class="flex-grow bg-[#faf3e0] p-2 rounded-lg border-2 border-gray-400 mb-2 shadow-inner">
                                <p class="responsive-text-lg text-gray-700">падьём бля ☀️☀️☀️ дел по горло а я тут лежу как каралева 👑👑😂</p>
                            </div>

                            <div class="flex-grow">
                                <h3 class="responsive-text-3xl font-bold text-gray-700 mb-2 text-center">Чё делать-то будем, ёпта?</h3>
                                <div class="actions-buttons-grid">
                                    <button onclick="performAction('cook')" class="action-button bg-green-600 hover:bg-green-700 text-white font-bold">Сварганить жратву</button>
                                    <button onclick="performAction('sleep')" class="action-button bg-blue-600 hover:bg-blue-700 text-white font-bold">Завалиться спать</button>
                                    <button onclick="performAction('watch_tv')" class="action-button bg-purple-600 hover:bg-purple-700 text-white font-bold">Пялиться в телек</button>
                                    <button onclick="performAction('monetka')" class="action-button bg-orange-500 hover:bg-orange-600 text-white font-bold">Сгонять в 'Монетку'</button>
                                    <button onclick="performAction('gossip')" class="action-button bg-pink-500 hover:bg-pink-600 text-white font-bold">Потрещать с Тимофеевной</button>
                                    <button onclick="performAction('tiktok')" class="action-button bg-black hover:bg-gray-800 text-white font-bold">Записать видос</button>
                                    <button onclick="performAction('stream')" class="action-button bg-red-600 hover:bg-red-700 text-white font-bold">Запустить стрим</button>
                                    <button onclick="performAction('call_sergey')" id="sergey-button" class="action-button bg-yellow-500 hover:bg-yellow-600 text-white font-bold" disabled>Позвать Серёгу</button>
                                    <button onclick="performAction('poop')" class="action-button bg-amber-800 hover:bg-amber-900 text-white font-bold">ПОСРАТЬ</button>
                                    <button onclick="performAction('fart')" class="action-button bg-lime-600 hover:bg-lime-700 text-white font-bold">Пердануть</button>
                                    <button onclick="performAction('suitors')" id="suitor-button" class="action-button bg-rose-500 hover:bg-rose-600 text-white font-bold">Искать жениха</button>
                                    <button onclick="manualSave()" class="action-button bg-cyan-600 hover:bg-cyan-700 text-white font-bold">Сохранить</button>
                                    <button onclick="forceRestart()" class="action-button bg-red-800 hover:bg-red-900 text-white font-bold col-span-full">Начать заново</button>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
    </div>
    
    <div id="suitor-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-40">
        <div class="bg-pink-100 p-8 rounded-lg text-center shadow-xl border-4 border-pink-400">
            <h2 class="font-lobster text-pink-800">Выбирай мужика!</h2>
            <div class="flex flex-col gap-4">
                <button onclick="selectSuitor('sergey')" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-lg">Серёга Орешкин (починит кран и пол пенсии)</button>
                <button onclick="selectSuitor('ivan')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">Иван Смайл (подарит смайлик и скроется)</button>
                <button onclick="selectSuitor('grigoriy')" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">Бомж Григорий (принесёт бутылки и блох)</button>
                <button onclick="selectSuitor('shrek')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg">Шрек (придёт с ослом)</button>
            </div>
        </div>
    </div>

    <div id="game-win-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-40">
        <div class="bg-green-100 p-8 rounded-lg text-center shadow-xl border-4 border-green-600">
            <h2 class="font-lobster text-green-800">ПОЗДРАВЛЯЮ!</h2>
            <p class="mb-6">БАБКА НИНКА НЕ СДОХЛА И ПРОДОЛЖИТ СТРИМИТЬ И ТАНЦЕВАТЬ В МАЛАДЁЖНУЮ СОЦСЕТЬ ТЕКТОК! 🥳🥳 ВАМ РАЗБЛОКИРОВАН СЛОЖНЫЙ РЕЖИМ. 💪👵</p>
            <button onclick="restartGame(true)" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">По новой, блядь!</button>
        </div>
    </div>

    <div id="screamer-modal" class="hidden fixed inset-0 bg-black z-50 flex items-center justify-center">
        <img id="screamer-image" src="https://zaebizwear.com/pidor/photo_2025-03-27_15-37-50.jpg" 
            onerror="this.onerror=null;this.src='https://placehold.co/600x600/000/fff?text=SCREAMER_ERROR';"/>
    </div>
    
    <div id="game-over-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-40">
        <div class="bg-white p-8 rounded-lg text-center shadow-xl">
            <h2 id="game-over-title" class="text-3xl font-bold mb-4">Ну всё, пиздец</h2>
            <p id="game-over-message" class="text-lg mb-6">Короче, ты отъехала.</p>
            <button onclick="restartGame(false)" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">По новой, блядь!</button>
        </div>
    </div>
    
    <audio id="bg-music" src="https://www.myinstants.com/media/sounds/muzykalnyi-perdiozh.mp3" loop></audio>
    <audio id="sfx-player"></audio>
    <audio id="poop-sound" src="https://www.myinstants.com/media/sounds/man-pooping-his-brains-out.mp3"></audio>
    <audio id="fart-sounds" src=""></audio>

<script>
    // Объект с фразами Бабки Нины
    const PHRASES = {
        fart: [
            "ух бля! 💨💨 как галубь мира вылител 🕊️🕊️", "палегче стала... 😌😌", "музычка! 🎶🎶", "ароматна... 🌸🌸🤣🤣",
            "надеюсь никто ни услышал... 🤫🤫 а если и услышал то похуй 👍", "эта я ни перднула эта душа плачит 😭😂", "ой... 😳",
            "выпустила демона 😈😈", "мАя падливка 🔥🔥🔥", "это вам за всё харошее! 👍💨", "прочистила дымоход 💨"
        ],
        suitors: [
            "так... старая калоша а любви хочица 💘💘 нада мужика искать 🧐", "время для ахоты! 🏹🏹 щас найду сибе алигарха... или алкаша... как пайдёт 🤷‍♀️🤣",
            "пайду на сайт знакмств... 💻 а нету... пайду на лавачку к падьезду 🏠"
        ],
        child_born: [
            "бля... я радила... 👶👶 назвала ево {name}!! 🥳🥳", "типерь у миня есть спинагрыз {name}!! 🤱🤱", "какой харошенький... тьфу тьфу тьфу... вылитый бамж григорий 🤣🤣"
        ],
        child_dead: [
            "мой {name} сдох... 😭 ну и хуй с ним 👍 па крайней мере прадукты жрать перестал... и на вкус как курятина 🍗🍗😋😋",
            "карочи... {name} кончился... 💀💀 пашол на пельмени... вкусна 🥟🥟🤤🤤"
        ],
        wake_up: [
            "падьём бля ☀️☀️☀️ дел по горло а я тут лежу как каралева 👑👑😂", "какова хрена так рана ⏰⏰⏰ апять этат будильник ебучий арёт 🤬🤬🤬",
            "так фстали атряхнулись и пашли наху... тоесть па дилам 🚶‍♀️🚶‍♀️🚶‍♀️🤣🤣", "снова утра 🌅🌅 сдохнутьбы да пенсию нада палучить 💸💸👍",
            "глаза прадрала а спина ни разгибаеца 👵👵👵 старость ни радасть а пиздес 😫😫😅", "кто я?? где я?? 🧐🧐 а я старая бабка в сваей халупе. заибись. 😂👍",
            "сонце в ибало светит ☀️😎😎 занавески нада была платнее задернуть 😡😡", "ищо адин день в этам дурдоме 🤪🤪 ну с богом или с чортом похуй 🙏😈🤣",
            "хочица лижать и пливать в паталок 💦💦 но нада итти и виршить виликие дила. например пасрать. 🚽💩😂", "праснулась но ни ачнулась 😵‍💫😵‍💫 дайте водки 🍶🍶 плиз 🙏😂",
            "фстать с кравати целый подвиг для маей тушы 🐘🐘", "апять спина болит и ноги гудят... жирная жизнь 😫😫"
        ],
        cook: [
            "ща сварганю хрючива штоб ни сдохнуть 🍲🍲 пельмени - пища багов 🥟🥟🤣🤣", "так где мая кастрюля?? 🍳🍳 хто спиздил маю каструлю?! 😡 а вот ана. будем варить суп из тапара и крепкава словца 🥣💪😂",
            "жрать захателась аж в глазах патимнело 👀👀 время для кулинарнава изнасилавния халадильника 🤪🤪", "шо у нас тут? прашлогодний агурец и дохлая мыш 🥒🐭 пайдёть 👍👍😂😂",
            "магу сварить кашу из ничиво 🥣🥣 и будит вкусна патамушта я галодная как сабака 🐕🐕🤤🤤", "маи катлеты могут убить 🥩💀 в прямом смысле. но я их люблю 🥰🥰😅",
            "гатовка - эта как секс. нада многа двигаца и громка станать от усталасти 🥵🥵🤣🤣🤣", "пахнет вкусна?? эта я лук жарю 🧅🧅 или у миня апять инсульть 🤪🤪🤪",
            "завтрак чимпиона: вчирашний чай и пазавчирашний хлеб ☕🍞 божествина 😇😇👍", "если ида упала на пол у миня есть 5 сикунд штобы иё паднять. и 5 часов штобы съесть 🤣🤣🤣👍",
            "время пажрать!! 🤤🤤 мая любимая часть дня 😋😋", "сделаю сибе бутерброд с калбасой... и с салом... и с сыром... и ищо адин 🥪🥪🥪"
        ],
        poop: [
            "аааааа... 😫😫 щас душа вылетит вместе с гавном 🕊️💩", "время ачистить кишечник! 🚽🚽 працес пашол!! 💨💨",
            "ах как харашо... 😌😌 как будто занава радилась 🥰🥰", "этат звук... 🔊🔊 эта музыка для маих ушей 🎶🎶😂",
            "палегчало... -5 кило гавна 🐘🐘🤣🤣", "высираю всю боль и абиды 😢😢 и серёгу тоже 😡",
            "нада было газету взять пачитать 📰📰 скучна... 😒", "унитаз - мой трон 👑👑 я тут каралева 👸👸",
            "чувствую сибя пустым внутри... 😌😌", "срать так срать! 💥💥 шоб саседи слышали! 📢📢🤣🤣"
        ],
        no_products: [
            "жрать нечива 😭😭😭 нада в магазин тащица 🛒🛒", "халадильник пустой как галава у серёги 🧠", "всё сожрала 😋😋 пора за новой партией говна в манетку 👍👍",
            "продукты кончились 😱😱 я скора с голоду сдохну 💀💀", "чтобы штота сварить нада штота иметь 🤷‍♀️🤷‍♀️ а у миня нихуя нет 😂",
            "мышь в халадильнике павесилась 🐭💀💀 нада в магаз 🏃‍♀️🏃‍♀️", "карочи жрать нету от слова савсем ❌❌❌", "сварила бы суп да не из чиво 🥣🥣😭",
            "в рот ничиво палажить 😫😫😫 апять в эту манетку пирица 😡", "хачу жрать а нечива!!!! 😡😡😡",
            "всё сожрала 🐷🐷 как ни в себя... нада в магаз за добавкой 🏃‍♀️🛒"
        ],
        sleep: [
            "вырубилась до утра 😴😴 галава чугунная но хоть силы есть 💪💪😅", "фсё на бакавую 🛌🛌 если серёга ночю насрёт пад двер - убю 🔪🔪😡",
            "завалилась спать 😴😴 пусь мне присница пенсия и дохлый депутат 💸💸💀😂😂", "хррр... пшшш... 💤💤 эта я сплю. или умираю. утрам разбирёмся 🤔🤔🤣🤣",
            "сон для слабаков 💪💪 а я очин сильная но паспать всё равно нада 😴😴", "мне приснилась што я маладая и красивая 👸👸 праснулась в халодном пату 😰😰😂",
            "ва сне я литала 🕊️🕊️ а патом упала с кравати 🤕🤕 больна сука 🤬🤬", "мой храп можит разбудить мёртвых 🧟‍♂️🧟‍♂️ и саседей. асобина саседей 📢📢🤣",
            "если я ни пасплю 8 чисов я привращаюсь в мигеру 👹👹 а если пасплю - тоже 🤪🤪", "сплю в абнимку с тапаром 🪓🪓 на всякий случай 😏😏",
            "кровать прагнулась пада мной... нада меньши жрать... шучу 🤣🤣🤣"
        ],
        watch_tv: [
            "фключаем зомбаящик 📺📺 о 'давай паженимся'! старые бляди ищут сибе дедаф-алкашей. класика 👍👍🤣🤣", "шо там па навастям? 🧐🧐 апять пиздят как дышат 🤥🤥 выключай нахуй эту прапаганду 🤬🤬",
            "ооо 'след' 👣👣 этих пидаров ищо ни закрыли? ладна пасметрим как они там трупы патрашат 🔪💀😂", "риклама стиральнава парашка 🧼🧼 как будто мне есть шо стирать кроме старых трусоф 🩲🩲🤣🤣",
            "малахав апять кавота с кемта мирит 👨‍⚖️👨‍⚖️ да пусть они друг друга паубивают так интиреснее будит 🍿🍿", "сматрю прагноз пагоды ☀️🌧️ завтра абищают пиздес. как и вчира и сиводня 🤷‍♀️🤷‍♀️",
            "сириал пра ментоф 👮‍♂️👮‍♂️ все такие чесные аж ташнит 🤢🤢 в жизнибы так 😂😂", "паказывают канцерт кабзона 🎤🎤 он ищо живой?? или эта запись с таво света?? 👻👻🤔",
            "пульт где?? 🧐🧐 хто праибал пульт?! а я на ньом сижу 🍑🍑🤣🤣", "на икране ачиридная гаварящая галава 🗣️🗣️ лучшебы жопу паказали 🍑🍑😂😂"
        ],
        monetka: [
            "НАКУПИЛА В МАНЕТКИ ПАКЕТ ГАВНА 😂😂😂 ЩАС БУДУ РАСПАКОВАЧКУ СНИМАТЬ 📦📦", "спустила пол пенсии на какуюто хуйню 💸💸 зато хата полная 🤣🤣",
            "тилежка была полная 🛒🛒 типерь халадильник полный 🧊🧊 заибись 👍", "патратила кучу бабла 🤑🤑 зато теперь есть чо жрать... наверна 🤔🤔",
            "взяла всё по акции 'два по цене трёх' 👍👍🤣🤣 я бизнисменша 💼💼", "касирша на миня сматрела как на дуру 👀👀 а я проста галодная была 🤷‍♀️🤷‍♀️",
            "притащила домой 10 пакетав 🛍️🛍️🛍️ щас здохну пака разбиру 🥵🥵", "закупилась так штоб месяц из дома ни выхадить 🏠🏠👍👍",
            "у миня теперь есть гречка, сахар, соль... 🧂🍚 осталось пережить ядерную вайну ☢️☢️🤣🤣", "я вашпето на диете... была... до манетки 😂😂😂",
            "нада тащить сваю тушу в магазин... лень... но жрать хочица 😩😩"
        ],
        gossip: [
            "пайду патрещу с тимафеевной старой перечницей 👵🌶️ узнаю хто с кем спит и хто шо украл 😏😏", "тимафеевна выхади подлая душа!! 🗣️🗣️ есть разгавор. нада кости пиримыть всиму падьезду 🦴🦴😂",
            "ща эта карга мне апять будит пра сваи балячки заливать 🤧🤒 ну ладна паслушаю хули делать 🤷‍♀️🤷‍♀️", "абсудили с тимафеевной праститутку с третива этажа 💃💃 гаварит цены падняла. савсем ахуела 🤬🤬",
            "тимафеевна видила как серёга ночю мусар вынасил 🗑️🗑️ в трусах. навернае апять пад чюто двер срать хадил 💩💩🤣", "гаварит у чисткова новый ухажор 👮‍♂️❤️‍🔥 интиресна хто этат нисчасный?? 🤔🤔",
            "сплетни - эта как семечки 🌻🌻 начнёш - ни астановишся 🤪🤪", "мы с тимафеевной - меснае фсб 🕵️‍♀️🕵️‍♀️ знаем фсё пра фсех 💪💪",
            "пиримыли кости фсем каму можна. и каму нельзя - тоже 👍👍😂😂", "после разгавора с тимафеевной хочица пайти и памыца 🚿🚿 но зато весела 🤣🤣"
        ],
        tiktok: [
            "время для тектока! 💃💃 ща пакажу маладьожи как нада жопай тристи! 🍑🍑", "записываю ачиридной шидевр 🎬🎬 я звизда а вы все - гавно! 🌟💩",
            "танцую пад маргенштерна 🎶🎶 штоп он сдох урод 💀💀", "делаю апзор на прасрочиную калбасу 🌭🤢 будит хить 👍👍",
            "паказываю как правильна ругаца 🗣️🤬 учу маладьож жить 💪💪", "мой акаунт в тектоке папулярнее чем иисус. навернае. 🙏🤣",
            "снимаю тренд где маску с лица снимают 🎭🎭 а у миня там ищо адна маска 😂😂😂", "нада бы хайпануть 🚀🚀 может галышом сплясать? 💃🔞",
            "маи видосы - эта искуства 🎨🎨 а хто ни сагласен - тот пидарас 👍👍", "устраиваю танцевальный батл с тараканами 💃🕺🐞 пабеждаит дружба 😂",
            "снимаю танец живота 💃💃 живот канешна бальшой зато какой есть 😂😂😂", "пытаюсь влезть в старое платье для видоса... трещит по швам 👗💥🤣🤣"
        ],
        stream: [
            "ВРУБАЮ СТРИМ! 🔴 ща данаты палетят 💸💸 гатовьте бабки нищеброды! 🤑🤑", "привет маи патпищики-далбаёбы! 👋👋 бапка в эфире кидайте маниту! 🪙🪙",
            "начинаим трансляцыю из маиво бапкина бункера. задавайте вапросы суки 🧐🗣️", "хто ни заданатит - тот лох. и серёга. 👍👍",
            "сабираю на новую вставную челюсь 🦷🦷 и на пива 🍺 кидайте бапки ни жмотьтесь 🙏🙏", "атвичаю на ваши тупые вапросы 🤔 да я старая. нет я ни скора сдохну 👵💪",
            "за данат в 1000 рублей пакажу сваю кошку 🐈🐈 за 5000 - станцую 💃💃", "этат стрим изминит вашу жизнь 🙏🙏 вы паймёте што вы - ничтожиства 💩💩",
            "спасиба за данат урод 👍💸 куплю сибе на них гроб ⚰️. шучу. куплю водки 🍶🤣", "кантент падъехал 🚚🚚 сматрите и ахуивайте 👀👀"
        ],
        call_sergey: [
            "АЛЁ СЕРЁГА ЭТА НИНКА! 📞📞 У МИНЯ ТУТ ВСЁ СЛАМАЛАСЬ ПРИХАДИ СКАРЕЕ!! 🖥️💥", "серёжаааааа памагиииии 😭🙏 мой кампуктер ни работаит 😡😡",
            "этот урод арешкин апять нужен... 😒😒 щас пазаву иво... 🚶‍♂️", "СЕРГЕЙ!! 🗣️🗣️ ТУТ ДЕЛА НА ПОЛПЕНСИИ!! 💸💸 ЗАХАДИ!!",
            "пришол... 😒😒 сматрит... чота там тыкает... 🧐🧐", "сказал 'ща всё будит' и папрасил денег... 💸💸 урод.",
            "капался там два часа... 🕑🕑 я чуть ни сдохла ат скуки 😴😴", "ВРОДЕ ПАЧИНИЛ!! 🥳🥳 НО СПИЗДИЛ СУКА ПОЛ ПЕНСИИ!!! 🤬🤬🤬",
            "ну всё работает... пака... 😒😒 до следущева раза... 😡", "спасиба серёжа... штоб ты сдох... 🙏💀🤣🤣"
        ],
        tech_broken: {
            tv: "ТЕЛЕК СДОХ!! 📺💥 ни паказывает малахова!! катострофа!! 😱😱",
            tiktok: "МОЙ ТИКТОК СЛАМАЛСЯ!!! 📵📵 как я типерь буду видосы снимать?!! 😭😭",
            stream: "СТРИМ НИ ЗАПУСКАЕЦА!!! 🖥️🚫 мои падпищики астануца без кантента!! 😡😡"
        },
        no_money: [
            "бабок нет! 😥 голяк! жди пенсию 👵", "деньги кончились блять! 😭 придёца сасать лапу 🐾🐾", "нищета ибаная! 🤬🤬 где маё лавэ? 💸💸",
            "в кармане - вошь на аркане. и то дохлая 🦗🦗", "нада бы аграбить банк 🏦💰 но лень 😴😴", "магу прадать почку. или душу. што дароже? 🤔🤔",
            "денег нет но вы диржитесь. и я падержусь. за хуй 👍👍🤣🤣", "пайду пабираца 🙏🙏 падайте старой бальной женщине на 'балтику 9' 🍺🍺",
            "финансы поют рамансы 🎶🎶 причём очень грусные 😥😥", "я ни бедная. я эканомная. очень сука эканомная 👍👍"
        ],
        no_energy: [
            "сил нет как у дохлай мухи 🦟🦟 нада атдахнуть 😴", "я заибалась. 😫😫 фсё никаких дел ❌❌", "чуствую сибя как выжатый лимон 🍋🍋 пайду прилягу 🛌",
            "энергия на нуле 🔋🔋 батириейка сдохла 💀💀", "если я щас встану я упаду. так шо лучше палижу 👍👍", "я устала как сабака 🐕🐕 причём как пабитая сабака 🤕🤕",
            "маё татемнае жывотнае - линивец 🦥🦥 тока я ищо и злая 🤬", "хочу умиреть 💀 но сначала нада паспать 😴",
            "двигаца лень. дышать лень. жить лень. 😩😩", "выключити миня. я хачу в спящий рижим 🚫🚫",
            "устала как будто вагон разгрузила... а я проста с дивана встала 😩😩", "маи кости стонут... прасят пащады и торта 🎂🎂"
        ],
        too_late: [
            "куда в такую темень? 🌃 спать пара валить 😴", "ночю тока черти шастают 😈😈 и серёга. сиди дома 🏠", "уже позна глаза слипаюца 😩😩",
            "после дисити на улицу выходют тока праститутки и маньяки 💃🔪 я ни атнашусь ни к тем ни к другим. пака што. 🤔", "тимно как у негра в жопе ⬛⬛ страшна 😨😨",
            "ночю все кошки серы 🐈‍⬛🐈‍⬛ и все люди - пидарасы 👍👍", "лучше дома сидеть и пирдеть в диван 💨💨 чем па начам шарица 🚶‍♀️",
            "мая кравать миня завёт 🛌🥰 и я ни магу ей атказать 🙏", "на ноч глядя тока за смертю хадить 💀💀 а ана и сама придёт 🤷‍♀️",
            "завтра рана фставать и нинавидеть мир 😡😡 нада набраца сил 💪"
        ],
        sergey_event: [
            "СЕРЁГА ПИДОР ВАНЮЧИЙ 🤬🤬 Я ТИБЯ НАЙДУ И ЯЙЦА НА ДВЕРНУЮ РУЧКУ НАМАТАЮ! 🔪🔪 ОПЯТЬ КУЧУ НАЛАЖИЛ! 💩💩", "БЛЯТЬ АПЯТЬ ГАВНОМ ВАНЯИТ 🤢🤢 АРЕШКИН УБЮ НАХУЙ! 😡 ГДЕ МАЯ ЛАПАТА?! ⛏️",
            "эта падла серёга апять испиолнел свой ритуал у маей двири 💩💩 штоб у ниво хуй на лбу вырос! 🙏🤣", "если я паймаю этава засранца я скармлю иво сабакам 🐕🐕 причом па чистям 💪💪",
            "пад маей дверю апять местыраждение удабрений 💩💩 серёга ты ни тока пидарас ты ищо и аграном! 👨‍🌾👨‍🌾🤣", "запахла висной и серёгиным дирьмом 🌸💩 рамантика блять 😂😂😂",
            "этат мудак метит тириторию как кабель 🐕💦 нада иво кастрирывать ✂️✂️", "я вызываю экзарциста ✝️✝️ или асинизатора 🚽 не знаю хто тут нужнее 🤔🤔",
            "нада паставить капкан 🪤 или мину 💣 штоб этаму пидару ноги атарвала 🙏🙏", "каждае утра - новый сюрприз 🎁💩 спасиба серёга што ни даёш скучать ублюдак 👍👍"
        ],
        game_over: {
            energy: "ну фсё пиздес 💀💀 атъехала бапка от усталасти 😥 нифартанула 👎",
            hunger: "с галадухи акачурилась 💀💀 а магла бы пильменей паесть дура 🥟🥟",
            mood: "загрустила и сдохла 😭 ибаная дипресия сажрала 💔💔",
            afk: "ты чо уснул там щенок?? 😴😴 бапка ждать ни любит! 🤬🤬",
            poop: "обосралась и умерла от стыда 💩💩💀💀 заибись 👍",
            fart: "допирделась... 💨💨 кишка выпала... 😱😱 пиздец... 💀",
            heart_attack: "сердечко прихватило 💔💔 от такой жирной и весёлой жизни... 💀💀"
        }
    };
    
    // Вспомогательная функция для получения случайной фразы
    const getRandomPhrase = (key) => PHRASES[key][Math.floor(Math.random() * PHRASES[key].length)];
    
    // Глобальное состояние игры и параметры режима
    let gameState = {};
    let GAME_PARAMS = {};

    // Функция для получения нового состояния игры (начальные значения)
    function getNewGameState() {
        return {
            day: 1, time: 8,
            stats: { energy: 100, mood: 70, hunger: 80, money: 5000, poop: 0 },
            products: 0,
            fartsToday: 0,
            suitorCooldown: 0,
            child: null,
            suitor: null,
            inventory: [], lastStreamDay: -2, isAsleep: false, gameOver: false,
            techState: { tv: 'ok', tiktok: 'ok', stream: 'ok' },
            nextBreakdownDay: Math.floor(Math.random() * 2) + 2,
        };
    }

    let inactivityTimer; // Таймер бездействия

    // Получаем ссылки на DOM-элементы
    const timeDisplay = document.getElementById('time-display');
    const energyVal = document.getElementById('energy-val');
    const moodVal = document.getElementById('mood-val');
    const hungerVal = document.getElementById('hunger-val');
    const moneyVal = document.getElementById('money-val');
    const poopVal = document.getElementById('poop-val');
    const productsCount = document.getElementById('products-count');
    const messageBox = document.getElementById('message-box');
    const childInfo = document.getElementById('child-info');
    const ninaSprite = document.getElementById('nina-sprite');
    const suitorPhotoContainer = document.getElementById('suitor-photo-container');
    const gameOverModal = document.getElementById('game-over-modal');
    const gameOverTitle = document.getElementById('game-over-title');
    const gameOverMessage = document.getElementById('game-over-message');
    const screamerModal = document.getElementById('screamer-modal');
    const gameWinModal = document.getElementById('game-win-modal');
    const suitorModal = document.getElementById('suitor-modal');
    const suitorButton = document.getElementById('suitor-button');
    const sergeyButton = document.getElementById('sergey-button');
    const bgMusic = document.getElementById('bg-music');
    const sfxPlayer = document.getElementById('sfx-player');
    const poopSound = document.getElementById('poop-sound');
    const fartSoundsPlayer = document.getElementById('fart-sounds');
    
    const appContainer = document.getElementById('app-container');
    const mainMenu = document.getElementById('main-menu');
    const gameScreen = document.getElementById('game-screen');
    const continueButton = document.getElementById('continue-button');
    const hardModeButton = document.getElementById('hard-mode-button');

    // Определите URL-ы для изображений Бабы Нины в разных состояниях
    const originalSprite = "https://100biografiy.ru/wp-content/uploads/2024/07/channels4_profile-2.jpg";
    const streamSprite = "https://zaebizwear.com/pidor/stream.jpg"; 
    
    // Звуки для пердежа
    const fartSounds = [
        'https://www.myinstants.com/media/sounds/fart-meme-sound.mp3',
        'https://www.myinstants.com/media/sounds/rec_10s_neLGvAd.mp3',
        'https://www.myinstants.com/media/sounds/fooz.mp3',
        'https://www.myinstants.com/media/sounds/09037.mp3'
    ];

    // Звуки для стрима
    const streamSounds = [
        "https://www.myinstants.com/media/sounds/muzykalnyi-perdiozh.mp3", // Пример, возможно лучше использовать другие звуки стрима
        "https://www.myinstants.com/media/sounds/rec_10s_neLGvAd.mp3", // Пример
        "https://www.myinstants.com/media/sounds/sfx_teleport_0.mp3" // Пример
    ];
    // Звук скримера (популярный звук из HL2)
    const screamerSound = "https://www.myinstants.com/media/sounds/hl2-stalker-scream.mp3";
    
    // Фотографии потенциальных женихов
    const SUITOR_PHOTOS = {
        sergey: 'https://zaebizwear.com/pidor/gay.jpg', // Сергей Орешкин
        ivan: 'https://zaebizwear.com/pidor/smile.jpg', // Иван Смайл
        grigoriy: 'https://www.meme-arsenal.com/memes/299e198aa1e19319430c7654f15996c0.jpg', // Бомж Григорий
        shrek: 'https://zaebizwear.com/pidor/shrek.jpg' // Шрек
    };

    // Параметры действий
    const actions = {
        cook: { time: 1, energy: -10, mood: 0, hunger: 50 },
        sleep: { time: 8, energy: 100, mood: 0, hunger: -20 },
        watch_tv: { time: 2, energy: -5, mood: 10, hunger: -5 },
        monetka: { time: 2, energy: -20, mood: 0, hunger: -5 },
        gossip: { time: 1, energy: -5, mood: 15, hunger: -5 },
        tiktok: { time: 1, energy: -15, mood: 25, hunger: -5 },
        stream: { time: 3, energy: -20, mood: 30, hunger: -10, money: 1000 },
        call_sergey: { time: 3, energy: -10, mood: -20 },
        poop: { time: 1, energy: -5, mood: 0 },
        fart: { energy: -1, mood: 3 },
        suitors: { time: 2, energy: -10 }
    };
    
    // Сохранение игры
    function manualSave() {
        localStorage.setItem('babkaNinaSave', JSON.stringify(gameState));
        addMessage("ИГРА САХРАНЕНА! 💾💾💾 можно спать спакойна 👍");
    }

    // Загрузка игры из localStorage
    function loadGame() {
        const savedGame = localStorage.getItem('babkaNinaSave');
        if (savedGame) {
            gameState = JSON.parse(savedGame);
            // Обеспечение совместимости со старыми сохранениями, если добавлены новые поля
            if (gameState.stats.poop === undefined) gameState.stats.poop = 0;
            if (gameState.fartsToday === undefined) gameState.fartsToday = 0;
            if (gameState.child === undefined) gameState.child = null;
            if (gameState.suitorCooldown === undefined) gameState.suitorCooldown = 0;
            if (gameState.suitor === undefined) gameState.suitor = null;
            // Сброс временных состояний при загрузке
            gameState.isAsleep = false; 
            gameState.gameOver = false; 
        } else {
            gameState = getNewGameState(); // Если сохранения нет, начать новую игру
        }
    }

    // Запуск скримера
    function triggerScreamer() {
        // Предотвратить повторный запуск скримера, если он уже активен
        if (screamerModal.classList.contains('hidden') === false) return;
        
        playSound(screamerSound); // Воспроизвести звук
        screamerModal.classList.remove('hidden'); // Показать модальное окно скримера
        screamerModal.classList.add('shake-animation'); // Запустить анимацию тряски
        
        // Скрыть скример через 2.5 секунды
        setTimeout(() => {
            screamerModal.classList.add('hidden');
            screamerModal.classList.remove('shake-animation');
        }, 2500);
    }

    // Game Over по бездействию (AFK)
    function afkGameOver() {
        if (gameState.gameOver || !screamerModal.classList.contains('hidden')) return; // Если игра уже окончена или скример активен, выйти
        gameState.gameOver = true;
        clearTimeout(inactivityTimer); // Остановить таймер бездействия

        playSound(screamerSound); // Запустить скример
        screamerModal.classList.remove('hidden');
        screamerModal.classList.add('shake-animation');
        
        // Показать сообщение Game Over после скримера
        setTimeout(() => {
            screamerModal.classList.add('hidden');
            screamerModal.classList.remove('shake-animation');

            gameOverTitle.textContent = "ЗА ИГНОР!";
            gameOverMessage.textContent = PHRASES.game_over.afk;
            gameOverModal.classList.remove('hidden');
        }, 2500);
    }

    // Сброс таймера бездействия
    function resetInactivityTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(afkGameOver, 30000); // 30 секунд бездействия
    }
    
    // Функция для воспроизведения звуков
    function playSound(src, player = sfxPlayer) {
        player.src = src;
        player.play().catch(e => console.error("Ошибка воспроизведения звука:", e));
    }
    
    // Добавление сообщения в лог игры
    function addMessage(text) {
        const p = document.createElement('p');
        p.textContent = `> ${text}`;
        p.classList.add('responsive-text-lg', 'text-gray-800', 'mb-1');
        messageBox.prepend(p); // Добавляем новые сообщения сверху
        // Ограничиваем количество сообщений, удаляя старые
        if(messageBox.children.length > 50) {
            messageBox.removeChild(messageBox.lastChild);
        }
        messageBox.scrollTop = 0; // Прокручиваем к началу, чтобы видеть новые сообщения
    }

    // Обновление элементов интерфейса игры
    function updateUI() {
        // Защита от NaN значений в статистике
        for (const key in gameState.stats) {
            if (isNaN(gameState.stats[key])) {
                console.error(`Stat ${key} became NaN! Resetting.`);
                gameState.stats[key] = 50;  
            }
        }
        
        // Ограничение значений статистики от 0 до 100 (кроме денег)
        Object.keys(gameState.stats).forEach(key => {
            if (key !== 'money') gameState.stats[key] = Math.max(0, Math.min(100, gameState.stats[key]));
        });
        
        // Обновление текстовых значений
        timeDisplay.textContent = `День ${gameState.day}, ${String(gameState.time).padStart(2, '0')}:00`;
        energyVal.textContent = Math.round(gameState.stats.energy);
        moodVal.textContent = Math.round(gameState.stats.mood);
        hungerVal.textContent = Math.round(gameState.stats.hunger);
        moneyVal.textContent = gameState.stats.money;
        poopVal.textContent = Math.round(gameState.stats.poop);
        productsCount.textContent = `${gameState.products} шт.`;

        // Управление доступностью кнопки "Позвать Серёгу"
        const isAnythingBroken = Object.values(gameState.techState).some(status => status === 'broken');
        sergeyButton.disabled = !isAnythingBroken;
        // Управление доступностью кнопки "Искать жениха"
        suitorButton.disabled = gameState.day < gameState.suitorCooldown || gameState.suitor !== null;

        // Отображение информации о ребенке или женихе
        if (gameState.child) {
            childInfo.innerHTML = `<p class="responsive-text-xl font-bold text-red-700">Спиногрыз: ${gameState.child.name} (помрёт через ${gameState.child.daysLeft} д.)</p>`;
        } else if (gameState.suitor) {
            childInfo.innerHTML = `<p class="responsive-text-xl font-bold text-blue-700">Жених: ${gameState.suitor.name} (уйдёт через ${gameState.suitor.daysLeft} д.)</p>`;
        }
        else {
            childInfo.innerHTML = '';
        }

        // Отображение фотографии жениха
        if (gameState.suitor) {
            suitorPhotoContainer.innerHTML = `<img src="${gameState.suitor.photo}" alt="${gameState.suitor.name}">`;
            suitorPhotoContainer.classList.remove('hidden');
        } else {
            suitorPhotoContainer.innerHTML = '';
            suitorPhotoContainer.classList.add('hidden');
        }
    }
    
    // Продвижение времени в игре
    function advanceTime(hours) {
        if (gameState.gameOver) return; // Если игра окончена, не продвигать время
        
        for (let i = 0; i < hours; i++) {
            gameState.time++;
            gameState.stats.hunger -= GAME_PARAMS.hungerDecay; // Убывание сытости
            gameState.stats.energy -= 1.5; // Убывание энергии
            gameState.stats.mood -= 1; // Убывание настроения
            gameState.stats.poop += 4; // Накопление "посрать"

            // Сообщения о позднем времени
            if (gameState.time === 22 && !gameState.isAsleep) addMessage(getRandomPhrase('too_late'));
            // Случайные события утром
            if (gameState.time === 7 && !gameState.isAsleep) triggerRandomEvent();

            // Переход на следующий день
            if (gameState.time >= 24) {
                gameState.day++;
                gameState.fartsToday = 0; // Сброс количества пердежей в день
                
                // Проверка условия победы
                if (gameState.day > 60) {
                    triggerWin();
                    return;
                }

                // Логика жениха
                if (gameState.suitor) {
                    gameState.suitor.daysLeft--;
                    if (gameState.suitor.type === 'leech') { // Если жених "паразит", забирает деньги
                        gameState.stats.money -= 500;
                        addMessage(`${gameState.suitor.name} спиздил 500 рублей на вейп... 💨`);
                    }
                    if (gameState.suitor.daysLeft <= 0) { // Если жених уходит
                        addMessage(`${gameState.suitor.name} съебался в закат... 🌅`);
                        gameState.suitor = null;
                    }
                }

                // Логика ребенка
                if (gameState.child) {
                    gameState.child.daysLeft--;
                    if(gameState.products > 0) { // Если есть продукты, ребенок ест
                        gameState.products--;
                        addMessage(`${gameState.child.name} сожрал 1 продукт... 👶`);
                    } else { // Если продуктов нет, ребенок голодает
                        gameState.stats.mood -= 10;
                        addMessage(`${gameState.child.name} орет от голода, а жрать нехуй!! 😭`);
                    }

                    if (gameState.child.daysLeft <= 0) { // Если ребенок умирает
                        const childName = gameState.child.name;
                        gameState.child = null;
                        gameState.stats.hunger = 100; // Бабка сыта после...
                        addMessage(getRandomPhrase('child_dead').replace('{name}', childName));
                    }
                }
                
                // Шанс сердечного приступа ближе к концу игры
                if(gameState.day >= 50 && gameState.day <= 60) {
                    if(Math.ceil(Math.random() * 20) === 1) { // 1 из 20 шанс
                        checkGameOver('heart_attack');
                        return;
                    }
                }

                // Сброс времени и статуса сна
                gameState.time = 8;
                gameState.isAsleep = false;
                addMessage(`Наступил новый день, твою мать... День ${gameState.day}.`);
                
                // Начисление пенсии
                if (gameState.day > 1 && gameState.day % 30 === 1) {
                    gameState.stats.money += GAME_PARAMS.pensionAmount;
                    addMessage(`ПЕНСИЯ ПРИШЛААА! +${GAME_PARAMS.pensionAmount} лавэ. ГУЛЯЕМ РВАНИНА!!! 🤑🤑🤑`);
                }

                // Поломка техники
                if (gameState.day >= gameState.nextBreakdownDay) {
                    const tech = ['tv', 'tiktok', 'stream'];
                    const brokenTech = tech[Math.floor(Math.random() * tech.length)]; // Случайная техника ломается
                    gameState.techState[brokenTech] = 'broken';
                    addMessage(PHRASES.tech_broken[brokenTech] + ' НАДА ЗВАТЬ СЕРЁГУ!!! 📞🤬');
                    gameState.nextBreakdownDay += Math.floor(Math.random() * 2) + 3; // Следующая поломка через 3-4 дня
                }
            }
        }
        updateUI(); // Обновить интерфейс после продвижения времени
        checkGameOver(); // Проверить условия Game Over
    }

    // Выполнение игрового действия
    function performAction(actionKey) {
        resetInactivityTimer(); // Сбросить таймер бездействия
        // Запретить действия, если игра окончена или бабка спит (кроме действия "спать")
        if (gameState.gameOver || (gameState.isAsleep && actionKey !== 'sleep')) {
            addMessage(gameState.isAsleep ? "Хр-р-р... спит бабка, не мешай." : "Всё, кина не будет. Отъехала.");
            return;
        }
        
        const action = actions[actionKey]; // Получить параметры действия

        // Проверка на достаточность энергии для действия
        if (action.energy < 0 && gameState.stats.energy < Math.abs(action.energy)) {
            addMessage(getRandomPhrase('no_energy'));
            return;
        }
        
        // Проверка на поломку техники
        if (actionKey === 'watch_tv' && gameState.techState.tv === 'broken') {
            addMessage(PHRASES.tech_broken.tv + ' НАДА ЗВАТЬ СЕРЁГУ!!! 📞🤬');
            return;
        }
        if (actionKey === 'tiktok' && gameState.techState.tiktok === 'broken') {
            addMessage(PHRASES.tech_broken.tiktok + ' НАДА ЗВАТЬ СЕРЁГУ!!! 📞🤬');
            return;
        }
        if (actionKey === 'stream' && gameState.techState.stream === 'broken') {
            addMessage(PHRASES.tech_broken.stream + ' НАДА ЗВАТЬ СЕРЁГУ!!! 📞🤬');
            return;
        }

        // Логика для конкретных действий
        if (actionKey === 'cook') {
            if (gameState.products <= 0) {
                addMessage(getRandomPhrase('no_products'));
                return;
            }
            gameState.products--; // Тратим 1 продукт
            gameState.stats.poop += 20; // Увеличиваем потребность "посрать"
            addMessage(getRandomPhrase(actionKey));
        } else if (actionKey === 'sleep') {
            const timeToSleep = (24 - gameState.time) + 8; // Спим до 8 утра следующего дня
            gameState.isAsleep = true;
            addMessage(getRandomPhrase('sleep'));
            gameState.stats.energy = 100; // Полное восстановление энергии
            gameState.stats.mood += action.mood;
            gameState.stats.hunger += action.hunger;
            advanceTime(timeToSleep); // Продвинуть время на весь период сна
            return; // Выйти, так как время уже продвинуто
        } else if (actionKey === 'monetka') {
            const cost = Math.floor(Math.random() * 1001) + 1000; // Стоимость продуктов от 1000 до 2000
            if (gameState.stats.money < cost) {
                addMessage(getRandomPhrase('no_money'));
                return;
            }
            gameState.stats.money -= cost;
            const productsBought = Math.floor(Math.random() * 3) + 2; // Покупаем 2-4 продукта
            gameState.products += productsBought;
            addMessage(`${getRandomPhrase(actionKey)} (-${cost} руб.💰, +${productsBought} продуктов 🛒)`);
        } else if(actionKey === 'stream'){
            if(gameState.day < gameState.lastStreamDay + 3){ // Стримить можно раз в 3 дня
                addMessage("Часто стримить вредно. Давай попозже.");
                return;
            }
            gameState.lastStreamDay = gameState.day; // Запоминаем день последнего стрима
            ninaSprite.src = streamSprite; // Меняем изображение Бабы Нины на "стримершу"
            playSound(streamSounds[Math.floor(Math.random() * streamSounds.length)]); // Играем случайный звук стрима
            addMessage(getRandomPhrase(actionKey));

            // Возвращаем исходное изображение после завершения звука стрима
            sfxPlayer.addEventListener('ended', () => {
                ninaSprite.src = originalSprite; 
                addMessage("Стрим окончен. Бабки получены, можно и расслабиться.");
            }, { once: true });
        } else if (actionKey === 'call_sergey') {
            const cost = Math.floor(gameState.stats.money / 2); // Сергей берет половину денег за ремонт
            gameState.stats.money -= cost;
            gameState.techState = { tv: 'ok', tiktok: 'ok', stream: 'ok' }; // Вся техника починена
            addMessage(getRandomPhrase(actionKey) + ` (-${cost} руб. 💸💸)`);
        } else if (actionKey === 'poop') {
            playSound(poopSound.src, poopSound); // Звук "посрать"
            gameState.stats.poop = 0; // Сбрасываем потребность "посрать"
            addMessage(getRandomPhrase('poop'));
        } else if (actionKey === 'fart') {
            gameState.fartsToday++; // Увеличиваем счетчик пердежей
            if (gameState.fartsToday > 10) { // Если слишком много пердежей, Game Over
                checkGameOver('fart');
                return;
            }
            playSound(fartSounds[Math.floor(Math.random() * fartSounds.length)], fartSoundsPlayer); // Случайный звук пердежа
            addMessage(getRandomPhrase('fart'));
        } else if (actionKey === 'suitors') {
            suitorModal.classList.remove('hidden'); // Открыть модальное окно выбора жениха
            return; // Выйти, так как время будет продвинуто после выбора жениха
        }
        else {
            addMessage(getRandomPhrase(actionKey));
        }
        
        // Предупреждение о позднем времени, если действие занимает много часов
        if (action.time && gameState.time >= 22) {
            addMessage(getRandomPhrase('too_late'));
        }
        
        // Обновление статистики после действия
        if (action.money) gameState.stats.money = Number(gameState.stats.money) + Number(action.money);
        gameState.stats.energy = Number(gameState.stats.energy) + Number(action.energy);
        gameState.stats.mood = Number(gameState.stats.mood) + Number(action.mood);
        if(actionKey === 'cook') {
            gameState.stats.hunger = Number(gameState.stats.hunger) + Number(action.hunger);
        } else {
            // Естественное убывание сытости, если это не готовка/еда
            gameState.stats.hunger = Number(gameState.stats.hunger) - 5;
        }
        
        // Продвижение времени, если действие занимает часы
        if (action.time) {
            advanceTime(action.time);
        } else {
            updateUI(); // Просто обновить UI, если время не менялось
        }
    }

    // Выбор жениха
    function selectSuitor(suitorName) {
        suitorModal.classList.add('hidden'); // Закрыть модальное окно
        addMessage(`выбрала мужика... ${suitorName}... посмотрим чо будит... 👀`);
        gameState.stats.mood = 100; // Поднять настроение
        gameState.suitorCooldown = gameState.day + 7; // Кульдаун на нового жениха

        // Данные о женихах
        const suitorData = {
            sergey: { name: 'Серёга Орешкин', type: 'child', photo: SUITOR_PHOTOS.sergey },
            ivan: { name: 'Иван Смайл', type: 'leech', photo: SUITOR_PHOTOS.ivan },
            grigoriy: { name: 'Бомж Григорий', type: 'child', photo: SUITOR_PHOTOS.grigoriy },
            shrek: { name: 'Шрек', type: 'child', photo: SUITOR_PHOTOS.shrek }
        };

        gameState.suitor = { ...suitorData[suitorName], daysLeft: 7 }; // Назначаем жениха на 7 дней

        // Логика появления ребенка
        if (gameState.suitor.type === 'child') {
            const nameParts1 = ['Абасралиус', 'Пердофил', 'Дристофан', 'Серговно'];
            const nameParts2 = ['Обдристий', 'Пердунович', 'Засранцев', 'Обосралов'];
            const childName = nameParts1[Math.floor(Math.random()*nameParts1.length)] + ' ' + nameParts2[Math.floor(Math.random()*nameParts2.length)];
            gameState.child = { name: childName, daysLeft: 7 }; // Ребенок появляется на 7 дней
            addMessage(getRandomPhrase('child_born').replace('{name}', childName));
        } else {
            addMessage('этот щенок будет жрать тваи деньги 💸💸');
        }
        
        const action = actions.suitors;
        gameState.stats.energy += action.energy;
        advanceTime(action.time); // Продвинуть время
    }
    
    // Запуск случайного ежедневного события
    function triggerRandomEvent() {
        const roll = Math.random();
        if (roll < 0.33) { // 33% шанс "сюрприза от Серёги"
            document.getElementById('game-container').classList.add('shake-animation'); // Трясем экран
            setTimeout(() => document.getElementById('game-container').classList.remove('shake-animation'), 500);
            gameState.stats.mood -= 25; // Портится настроение
            addMessage(getRandomPhrase('sergey_event'));
        } else if (roll < 0.66) { // 33% шанс ЖКХ
            gameState.stats.money -= Math.floor(Math.random() * 200) + 100; // Тратим деньги
            addMessage("Пришла квитанция за ЖКХ. Грабят средь бела дня, черти! Лавэ улетело.");
        }
        updateUI(); // Обновить интерфейс
    }

    // Условие победы
    function triggerWin() {
        gameState.gameOver = true;
        clearTimeout(inactivityTimer);
        localStorage.setItem('babkaGameWon', 'true'); // Разблокировать сложный режим
        gameWinModal.classList.remove('hidden'); // Показать окно победы
    }

    // Проверка условий Game Over
    function checkGameOver(forcedReason = null) {
        if (gameState.gameOver) return; // Если уже Game Over, выйти
        
        let reasonKey = forcedReason; // Причина, если она явно указана
        if (!reasonKey) { // Если причина не указана, проверить по статистике
            if (gameState.stats.energy <= 0) reasonKey = "energy";
            else if (gameState.stats.hunger <= 0) reasonKey = "hunger";
            else if (gameState.stats.mood <= 0) reasonKey = "mood";
            else if (gameState.stats.poop >= 100) reasonKey = "poop";
            else if (gameState.fartsToday > 10) reasonKey = "fart";
            else if (gameState.stats.money < 1) reasonKey = "hunger"; // Умереть от голода, если нет денег
        }

        if (reasonKey) { // Если найдена причина Game Over
            gameState.gameOver = true;
            clearTimeout(inactivityTimer); // Остановить таймер бездействия
            triggerScreamer(); // Запустить скример
            // Показать сообщение Game Over после скримера
            setTimeout(() => {
                gameOverTitle.textContent = "Ну всё, пиздец";
                gameOverMessage.textContent = `${PHRASES.game_over[reasonKey]} Прожила ${gameState.day - 1} дней. Не густо.`;
                gameOverModal.classList.remove('hidden');
            }, 2500);
        }
    }
    
    // Перезапуск игры (из окна победы/поражения)
    function restartGame(fromWinOrLoss) {
        if(fromWinOrLoss) { // Если переход из окна победы/поражения
            mainMenu.classList.remove('hidden'); // Показать главное меню
            gameScreen.classList.add('hidden'); // Скрыть игровой экран
            gameOverModal.classList.add('hidden');
            gameWinModal.classList.add('hidden');
            // Обновить видимость кнопки "Продолжить"
            if (localStorage.getItem('babkaNinaSave')) {
                continueButton.style.display = 'inline-block';
            } else {
                continueButton.style.display = 'none';
            }
            // Разблокировать сложный режим, если игра выиграна
            if (localStorage.getItem('babkaGameWon')) {
                hardModeButton.disabled = false;
                hardModeButton.classList.remove('bg-gray-500', 'cursor-not-allowed');
                hardModeButton.classList.add('bg-purple-700', 'hover:bg-purple-800');
            }
        } else { // Если просто Game Over и нужно начать заново
            gameOverModal.classList.add('hidden');
            mainMenu.classList.remove('hidden');
            gameScreen.classList.add('hidden');
        }
    }
    
    // Принудительный перезапуск игры (из игрового экрана)
    function forceRestart() {
        localStorage.removeItem('babkaNinaSave'); // Удалить сохранение
        continueButton.style.display = 'none'; // Скрыть кнопку "Продолжить"
        initGame(false, gameState.gameMode || 'normal'); // Начать новую игру в текущем или нормальном режиме
        addMessage("ИГРА НАЧАТА ЗАНОВА ПО ТРЕБОВАНИЮ ТРУДЯЩИХСЯ! ✊✊");
    }

    // Запуск игры (из главного меню)
    function startGame(mode, continueGame) {
        // Установка параметров сложности
        if (mode === 'hard') {
            GAME_PARAMS = { hungerDecay: 5, pensionAmount: 10000 };
        } else {
            GAME_PARAMS = { hungerDecay: 3, pensionAmount: 15000 };
        }
        
        mainMenu.style.display = 'none'; // Скрыть главное меню
        gameScreen.style.display = 'flex'; // Показать игровой экран
        
        initGame(continueGame, mode); // Инициализировать игру
        
        // Попытка автозапуска фоновой музыки
        const musicPromise = bgMusic.play();
        if (musicPromise !== undefined) {
            musicPromise.then(_ => {
                bgMusic.volume = 0.2; // Установить громкость
            }).catch(error => {
                console.log("Автозапуск музыки заблокирован. Нажмите в любом месте, чтобы запустить.");
                // Если автозапуск заблокирован, запустить музыку по первому клику пользователя
                document.body.addEventListener('click', () => {
                    bgMusic.volume = 0.2;
                    bgMusic.play();
                }, { once: true });
            });
        }
    }

    // Инициализация игры (новая игра или загрузка)
    function initGame(continueGame, mode) {
        if (continueGame && localStorage.getItem('babkaNinaSave')) {
            loadGame(); // Загрузить сохраненную игру
            addMessage("ЗАГРУЗКА СОХРАНЕНИЯ...");
        } else {
            gameState = getNewGameState(); // Начать новую игру
        }
        
        gameState.gameMode = mode; // Установить режим игры
        updateUI(); // Обновить интерфейс
        addMessage(getRandomPhrase('wake_up')); // Вывести стартовую фразу
        resetInactivityTimer(); // Запустить таймер бездействия
    }

    // После загрузки страницы - показать главное меню и проверить сохранения
    window.onload = () => {
        mainMenu.style.display = 'flex'; // Показать главное меню
        // Проверить наличие сохраненной игры и обновить видимость кнопки "Продолжить"
        if (!localStorage.getItem('babkaNinaSave')) {
            continueButton.style.display = 'none';
        } else {
            continueButton.style.display = 'inline-block';
        }
        // Проверить, была ли игра выиграна, и разблокировать сложный режим
        if (!localStorage.getItem('babkaGameWon')) {
            hardModeButton.disabled = true;
            hardModeButton.classList.add('bg-gray-500', 'cursor-not-allowed');
        } else {
            hardModeButton.disabled = false;
            hardModeButton.classList.remove('bg-gray-500', 'cursor-not-allowed');
            hardModeButton.classList.add('bg-purple-700', 'hover:bg-purple-800'); // Добавляем обратно стили активной кнопки
        }
    };
    
</script>

</body>
</html>
